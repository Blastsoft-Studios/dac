{% extends "main.html" %}
{% load staticfiles %}

{% block head %}
	<script src='https://www.google.com/recaptcha/api.js'></script>
{% endblock %}

{% block body %}

	<div class="row">
		<div class="col-sm-6 col-sm-offset-3">

			<h1 class="text-center">Discord Avatar Change</h1>

			<p></p>

			<div class="row">
				<div id="message"></div>
			</div>

			<form id="dac" action="{% url "avatar" %}" enctype="multipart/form-data" method="POST">
				{% csrf_token %}

				<p></p>

				<div class="form-group">
					<label for="inputName">Bot Username</label>
					<input type="text" class="form-control" id="inputName" name="inputName" placeholder="Bot Username" autofocus required>
				</div>

				<div class="form-group">
					<label for="inputToken">OAuth Token</label>
					<input type="text" class="form-control" id="inputToken" name="inputToken" placeholder="Bot's OAuth Token" required>
				</div>

				<div class="form-group">
					<label for="inputAvatarFile">Avatar File</label>
					<input type="file" class="file-upload" id="inputAvatarFile" name="inputAvatarFile" required>
				</div>

				<div class="form-group">
					<button type="submit" class="btn btn-danger">Chnage Avatar</button>
				</div>

				{% if request.session.recaptchaverified %}{% else %}
					<div class="row">
						<div style="margin: 0 auto; display: block; width: 304px;" class="g-recaptcha" data-sitekey="6LdRLSQTAAAAAAKDwrL9Tqhglu0EJ6PWHEPJhmy_"></div>
					</div>
				{% endif %}

				<p></p>

				<div class="row">
					<div id="results"></div>
				</div>

			</form>

		</div>
	</div>



<!--
	<script type="text/javascript">

		var data = new FormData();
		jQuery.each(jQuery('#dac')[0].files, function(i, file) {
				data.append('file-'+i, file);
		});


		$("form#dac").submit(function(event) {

				event.preventDefault();

				var formData = new FormData($(this)[0]);

				$.post($(this).attr("action"), formData, function(data) {
						alert(data);
				});

				return false;
		});

	</script>
-->



	<script type="text/javascript">

		$('#dac').on('submit', function(event){

				event.preventDefault();

				var formData = new FormData($(this)[0]);

				$.ajax({
						url: '/avatar/',
						type: 'POST',
						data: formData,
						async: false,
						success: function(data, textStatus, jqXHR){
							console.log("Status: "+textStatus+" Data: "+data);
							$('#message').html("<div class='alert alert-success alert-dismissible' role='alert'><button type='button'" +
								" class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>&times;</span></button> " +
								"Avatar Successfully Changed.</div>");

							$('#results').html("<h4>Response:</h4><pre>"+data+"</pre>");

							$( ".g-recaptcha" ).remove();
						},
						error: function(data, textStatus, errorThrown) {
							console.log("Status: "+textStatus+" Data: "+data.responseText);
							$('#message').html("<div class='alert alert-danger alert-dismissible' role='alert'><button type='button'" +
								" class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>&times;</span></button> " +
								"Error: "+data.responseText+"</div>");
						},
						cache: false,
						contentType: false,
						processData: false
				});

				return false;
		});



{#		$('#dac').on('submit', function(event){#}
{##}
{#			event.preventDefault();#}
{##}
{#			$.post('/avatar/', $('#dac').serialize(), 'POST');#}
{##}
{#			$( document ).ajaxError(function( event, request, settings ) {#}
{#				console.log("Status: "+request.status+" Data: "+request.responseText);#}
{#				$('#message').html("<div class='alert alert-danger alert-dismissible' role='alert'><button type='button'" +#}
{#					" class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>&times;</span></button> " +#}
{#					"Error: "+request.responseText+"</div>");#}
{#			});#}
{##}
{#			$( document ).ajaxSuccess(function( event, request, settings ) {#}
{#				console.log("Status: "+request.status+" Data: "+request.responseText);#}
{#				$('#message').html("<div class='alert alert-success alert-dismissible' role='alert'><button type='button'" +#}
{#					" class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>&times;</span></button> " +#}
{#					"Avatar Successfully Changed.</div>");#}
{##}
{#				$('#results').html("<h4>Response:</h4><pre>"+request.responseText+"</pre>");#}
{##}
{#				$( ".g-recaptcha" ).remove();#}
{#			});#}
{##}
{#		});#}

	</script>


{% endblock %}


				<!--
					<legend class="sr-only">Discord Bot Avatar Change</legend>
					<div class="form-group">
						<label for="inputName" class="col-md-3 control-label">Bot Name</label>
						<div class="col-md-9">
							<input type="text" class="form-control" id="inputName" name="inputName" placeholder="Bot Username" autofocus required>
						</div>
					</div>
					<div class="form-group">
						<label for="inputEmail" class="col-md-3 control-label">OAuth Token</label>
						<div class="col-md-9">
							<input type="text" class="form-control" id="inputToken" name="inputToken" placeholder="Bot's OAuth Token" required>
						</div>
					</div>
					<div class="form-group">
						<label for="inputBattleTag" class="col-md-3 control-label">Avatar File</label>
						<div class="col-md-3">
							<label class="btn btn-primary" for="my-file-selector">
								<input id="my-file-selector" type="file" style="display:none;" onchange="$('#upload-file-info').html($(this).val());">
								Select File
							</label>
							<span class='label label-info' id="upload-file-info"></span>
						</div>
						<div class="pull-right form-group">
							<button type="submit" class="btn btn-danger">Chnage Avatar</button>
						</div>
					</div>
				-->

				<!--
					<div class="row">
						<div class="col-sm-9 col-sm-offset-3">
							<button type="submit" class="btn btn-danger">Chnage Avatar</button>
						</div>
					</div>
				-->